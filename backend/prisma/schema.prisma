// Prisma schema for Virtual Stock Portfolio Management
// Using MySQL database

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// User model - stores user account information
model User {
  id          String       @id @default(uuid())
  name        String
  email       String       @unique
  password    String       // Hashed password
  createdAt   DateTime     @default(now())
  
  // Relations
  wallet      Wallet?
  portfolio   Portfolio[]
  transactions Transaction[]

  @@map("users")
}

// Wallet model - stores user's virtual cash balance
model Wallet {
  id        String   @id @default(uuid())
  balance   Float    @default(1000000) // Initial balance: $1,000,000
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("wallets")
}

// Stock model - stores available stocks in the market
model Stock {
  id          String       @id @default(uuid())
  symbol      String       @unique // Stock ticker symbol (e.g., "AAPL")
  name        String       // Company name
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  // Relations
  portfolio   Portfolio[]
  transactions Transaction[]

  @@map("stocks")
}

// Portfolio model - stores user's stock portfolio (how many shares they own)
model Portfolio {
  id          String   @id @default(uuid())
  quantity    Int      // Number of shares owned
  avgBuyPrice Float    // Average price at which shares were bought
  userId      String   // Foreign key to User
  stockId     String   // Foreign key to Stock
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  stock       Stock    @relation(fields: [stockId], references: [id], onDelete: Cascade)

  @@unique([userId, stockId]) // One portfolio entry per user per stock
  @@map("portfolios")
}

// Transaction model - stores buy/sell transaction history
model Transaction {
  id        String   @id @default(uuid())
  type      String   // "BUY" or "SELL"
  quantity  Int      // Number of shares traded
  price     Float    // Price per share at transaction time
  userId    String   // Foreign key to User
  stockId   String   // Foreign key to Stock
  createdAt DateTime @default(now())
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  stock     Stock    @relation(fields: [stockId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

